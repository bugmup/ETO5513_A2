---
title: Analysis of Australia's Higher Education Loan Program
  (HELP) Statistics
author: "Alana Dabelstein, Anh-Thu Hoang, Chenxi Zhang"
date: "01/06/2023"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: paper
    fig_width: 9
    fig_height: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Loading Libraries
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(tidyverse)
library(knitr)

# Loading Data
table_1 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 2, skip = 2, col_names = TRUE)
table_2 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 3, skip = 2, col_names = TRUE)
table_3 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 4, skip = 2, col_names = TRUE)
table_4 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 5, skip = 2, col_names = TRUE)
table_7 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 8, skip = 2, col_names = TRUE)
```

## Introduction

## Analysis

### Alana's Part

### Taxable Income Group

3. What was the distribution of taxable (HELP repayment) income of HELP debtors in Australian States and Territories in the 2021-22 financial year?

```{r Income Distribution, echo=FALSE, message=FALSE, warning=FALSE}

income_dist <- table_7 %>%
  select('Financial year', 'HELP repayment income', 'ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA') %>%
  filter(`Financial year` == "2021–22") %>%
  filter(`HELP repayment income` != "Unknown")

pivoted_dist <- income_dist %>%
  pivot_longer(
    cols = c('ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA'),
    names_to = "State",
    values_to = "Count")

income_factor = c("Up to $9,999", "$10,000 to $19,999", "$20,000 to $29,999", "$30,000 to $39,999", "$40,000 to $49,999", "$50,000 to $59,999", "$60,000 to $69,999", "$70,000 to $79,999", "$80,000 to $89,999", "$90,000 to $99,999", "$100,000 to $109,999", "$110,000 to $119,999", "$120,000 to $129,999", "$130,000 or more")

dist_plot <- ggplot(data = pivoted_dist, aes(x = factor(`HELP repayment income`, level = income_factor), y = Count, fill = State)) +
  geom_bar(stat="identity") +
  theme(panel.grid.major = element_line(color = "grey",
                                        size = 0.5,
                                        linetype = 3),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_y_continuous(name="Count of Debtors", labels = label_comma(), 
                     breaks = seq(0, 350000, by = 50000)) +
  xlab("Income Group") +
  labs(title = "Figure 3: Distribution of HELP debtor income in Australian States and Territories", subtitle = "There is a postive skew in the distribution of HELP debtor income", caption = "Data source: Data.gov.au")

kable(income_dist, col.names = c("Financial Year","HELP Repayment Income", "ACT", "NSW", "NT", "QLD", "SA", "TAS", "VIC", "WA"), caption = "Table 3: Table of count of outstanding HELP debtors in each income group by State or Territory in 2021-22")

dist_plot

```

4. What trend can be observed of the median and mean taxable (HELP repayment) income of HELP debtors in Australia over time?

```{r Median Income, echo=FALSE, message=FALSE, warning=FALSE}

median_income <- table_7 %>%
  select('Financial year', 'HELP repayment income', 'ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA') %>%
  filter(`HELP repayment income` != "Unknown")

median_pivot <- median_income %>%
  pivot_longer(
    cols = c('ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA'),
    names_to = "State",
    values_to = "Count")

median_pivot <- mutate(median_pivot, `HELP repayment income` = case_when(
    `HELP repayment income`=="Up to $9,999" ~ 9999,
    `HELP repayment income`=="$10,000 to $19,999" ~ 19999, 
    `HELP repayment income`=="$20,000 to $29,999" ~ 29999, 
    `HELP repayment income`=="$30,000 to $39,999" ~ 39999, 
    `HELP repayment income`=="$40,000 to $49,999" ~ 49999, 
    `HELP repayment income`=="$50,000 to $59,999" ~ 59999, 
    `HELP repayment income`=="$60,000 to $69,999" ~ 69999, 
    `HELP repayment income`=="$70,000 to $79,999" ~ 79999, 
    `HELP repayment income`=="$80,000 to $89,999" ~ 89999, 
    `HELP repayment income`=="$90,000 to $99,999" ~ 99999, 
    `HELP repayment income`=="$100,000 or more" ~ 100000,
    `HELP repayment income`=="$100,000 to $109,999" ~ 109999,
    `HELP repayment income`=="$110,000 to $119,999" ~ 119999, 
    `HELP repayment income`=="$120,000 to $129,999" ~ 129999, 
    `HELP repayment income`=="$130,000 or more" ~ 130000,
    is.na(`HELP repayment income`) ~ 0
    ))

median_pivoted <- median_pivot %>%
  group_by(`Financial year`) %>%
  summarise(
    `Count of Debtors` = sum(Count),
    `Median Income` = sort(rep(`HELP repayment income`,Count))[length(rep(`HELP repayment income`,Count))/2],
    `Mean Income` = sum(sort(rep(`HELP repayment income`,Count)))/length(sort(rep(`HELP repayment income`,Count)))
  )

median_pivoted <- mutate(median_pivoted, `Median Income` = case_when(
    `Median Income`==9999 ~ "Up to $9,999",
    `Median Income`==19999 ~ "$10,000 to $19,999", 
    `Median Income`==29999 ~ "$20,000 to $29,999", 
    `Median Income`==39999 ~ "$30,000 to $39,999", 
    `Median Income`==49999 ~ "$40,000 to $49,999", 
    `Median Income`==59999 ~ "$50,000 to $59,999", 
    `Median Income`==69999 ~ "$60,000 to $69,999", 
    `Median Income`==79999 ~ "$70,000 to $79,999", 
    `Median Income`==89999 ~ "$80,000 to $89,999", 
    `Median Income`==99999 ~ "$90,000 to $99,999",
    `Median Income`==100000 ~ "$100,000 or more",
    `Median Income`==109999 ~ "$100,000 to $109,999", 
    `Median Income`==119999 ~ "$110,000 to $119,999", 
    `Median Income`==129999 ~ "$120,000 to $129,999", 
    `Median Income`==130000 ~ "$130,000 or more"
    ))

median_pivoted2 <- mutate(median_pivoted, `Mean Income` = case_when(
    `Mean Income`<=9999 ~ "Up to $9,999",
    `Mean Income`<=19999 ~ "$10,000 to $19,999", 
    `Mean Income`<=29999 ~ "$20,000 to $29,999", 
    `Mean Income`<=39999 ~ "$30,000 to $39,999", 
    `Mean Income`<=49999 ~ "$40,000 to $49,999", 
    `Mean Income`<=59999 ~ "$50,000 to $59,999", 
    `Mean Income`<=69999 ~ "$60,000 to $69,999", 
    `Mean Income`<=79999 ~ "$70,000 to $79,999", 
    `Mean Income`<=89999 ~ "$80,000 to $89,999", 
    `Mean Income`<=99999 ~ "$90,000 to $99,999",
    `Mean Income`==100000 ~ "$100,000 or more",
    `Mean Income`<=109999 ~ "$100,000 to $109,999", 
    `Mean Income`<=119999 ~ "$110,000 to $119,999", 
    `Mean Income`<=129999 ~ "$120,000 to $129,999", 
    `Mean Income`<=130000 ~ "$130,000 or more"
    ))

median_plot <- ggplot(median_pivoted2, aes(x=`Financial year`)) + 
  geom_line(aes(y = `Median Income`, group = 1, color = "Median")) +
  geom_point(aes(y = `Median Income`, group = 1, color = "Median")) +
  geom_line(aes(y = `Mean Income`, group = 1, color = "Mean")) +
  geom_point(aes(y = `Mean Income`, group = 1, color = "Mean")) +
  scale_color_manual(values = c(Median = "steelblue", Mean = "darkred"), 
                     labels = c(Median = "Median income", Mean = "Mean income")) +
  labs(title = "Figure 4: Median and mean income of HELP debtors in Australia from 2009 to 2021", 
       subtitle = "There has been a positive increase in median taxable income over time", 
       caption = "Data source: Data.gov.au") +
  ylab("Income Group") +
  xlab("Year") +
  guides(col=guide_legend("Legend")) +
  theme(panel.grid.major = element_line(color = "grey",
                                        size = 0.5,
                                        linetype = 3),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

kable(median_pivoted2, col.names = c("Financial Year", "Count of Outstanding Debtors", "Median Income", "Mean Income"), caption = "Table 4: Table of the median and mean taxable income group of outstanding HELP debtors in Australia from 2009-10 to 2021-22")

median_plot
```
Table 3 presents the counts of students with outstanding HELP debt in each taxable income group, incremented by $10,000, in all States and Territories in the 2021 fiscal year. The distribution of which is illustrated as a bar chart in Figure 3. Across all income groups, NSW, QLD and VIC have the highest number of outstanding HELP debtors, and the most debtors earned within the $20,000 to $29,999 income group in 2021. 

Table 4 presents the calculations of median and mean earned income groups in Australia from 2009 to 2021. The trends of which are illustrated as a line chart in Figure 4. Both the median and mean income follow the same increasing trend while the median sits below the mean by 1 income group. Both have increased by 1 income group ($10,000) since 2009. The median income group in 2021 was $40,000 to $49,999, while the mean was $50,000 to $59,999.

It can be concluded that most debtors end up earning below the mean income and the number of debtors earning above the mean diminishes as the income group increases. However, a larger number of debtors in the “$130,000 or more” income group is observed as it is an exception to the $10,000 increment rule.

The limitation of this analysis is that the data fails to account for the size of the HELP debt incurred and how far along each debtor is in their career. Greater debt may indicate higher education or further progressed careers may indicate more employability which may impact the income earned. 


### Chenxi's Part

## Conclusion

## References

## Appendix

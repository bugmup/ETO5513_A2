---
title: Analysis of Australia's Higher Education Loan Program
  (HELP) Statistics
author: "Alana Dabelstein, Anh-Thu Hoang, Chenxi Zhang"
date: "01/06/2023"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: paper
    fig_width: 7
    fig_height: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Loading Libraries
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(tidyverse)

# Loading Data
table_1 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 2, skip = 2, col_names = TRUE)
table_2 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 3, skip = 2, col_names = TRUE)
table_3 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 4, skip = 2, col_names = TRUE)
table_4 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 5, skip = 2, col_names = TRUE)
table_7 <- read_xlsx("Data/help-statistics-2021-2022.xlsx", sheet = 8, skip = 2, col_names = TRUE)
```

## Introduction

## Analysis

### Alana's Part

### Anh-Thu's Part

3. What was the distribution of taxable (HELP repayment) income of HELP debtors in Australian States and Territories in the 2021-22 financial year?

```{r Income Distribution, echo=FALSE, message=FALSE, warning=FALSE}

income_dist <- table_7 %>%
  select('Financial year', 'HELP repayment income', 'ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA') %>%
  filter(`Financial year` == "2021â€“22") %>%
  filter(`HELP repayment income` != "Unknown")

pivoted_dist <- income_dist %>%
  pivot_longer(
    cols = c('ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA'),
    names_to = "State",
    values_to = "Count")

income_factor = c("Up to $9,999", "$10,000 to $19,999", "$20,000 to $29,999", "$30,000 to $39,999", "$40,000 to $49,999", "$50,000 to $59,999", "$60,000 to $69,999", "$70,000 to $79,999", "$80,000 to $89,999", "$90,000 to $99,999", "$100,000 to $109,999", "$110,000 to $119,999", "$120,000 to $129,999", "$130,000 or more")

dist_plot <- ggplot(data = pivoted_dist, aes(x = factor(`HELP repayment income`, level = income_factor), y = Count, fill = State)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_y_continuous(name="Count of Income", labels = label_comma()) +
  xlab("Income Group") +
  labs(title = "Distribution of HELP debtor income in Australian States and Territories", subtitle = "There is a postive skew in the distribution of HELP debtor income", caption = "Data source: Data.gov.au")

dist_plot

```

4. What trend can be observed of the median taxable (HELP repayment) income of HELP debtors in Australia over time?

```{r Median Income, echo=FALSE, message=FALSE, warning=FALSE}

median_income <- table_7 %>%
  select('Financial year', 'HELP repayment income', 'ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA') %>%
  filter(`HELP repayment income` != "Unknown")

median_pivot <- median_income %>%
  pivot_longer(
    cols = c('ACT', 'NSW', 'NT', 'QLD', 'SA', 'TAS', 'VIC', 'WA'),
    names_to = "State",
    values_to = "Count")

median_pivot <- mutate(median_pivot, `HELP repayment income` = case_when(
    `HELP repayment income`=="Up to $9,999" ~ 9999,
    `HELP repayment income`=="$10,000 to $19,999" ~ 19999, 
    `HELP repayment income`=="$20,000 to $29,999" ~ 29999, 
    `HELP repayment income`=="$30,000 to $39,999" ~ 39999, 
    `HELP repayment income`=="$40,000 to $49,999" ~ 49999, 
    `HELP repayment income`=="$50,000 to $59,999" ~ 59999, 
    `HELP repayment income`=="$60,000 to $69,999" ~ 69999, 
    `HELP repayment income`=="$70,000 to $79,999" ~ 79999, 
    `HELP repayment income`=="$80,000 to $89,999" ~ 89999, 
    `HELP repayment income`=="$90,000 to $99,999" ~ 99999, 
    `HELP repayment income`=="$100,000 or more" ~ 100000,
    `HELP repayment income`=="$100,000 to $109,999" ~ 109999,
    `HELP repayment income`=="$110,000 to $119,999" ~ 119999, 
    `HELP repayment income`=="$120,000 to $129,999" ~ 129999, 
    `HELP repayment income`=="$130,000 or more" ~ 130000,
    is.na(`HELP repayment income`) ~ 0
    ))

median_pivoted <- median_pivot %>%
  group_by(`Financial year`) %>%
  summarise(
    median_income = sort(rep(`HELP repayment income`,Count))[length(rep(`HELP repayment income`,Count))/2]
  )

median_pivoted <- mutate(median_pivoted, median_income = case_when(
    median_income== 9999 ~ "Up to $9,999",
    median_income==19999 ~ "$10,000 to $19,999", 
    median_income==29999 ~ "$20,000 to $29,999", 
    median_income==39999 ~ "$30,000 to $39,999", 
    median_income==49999 ~ "$40,000 to $49,999", 
    median_income==59999 ~ "$50,000 to $59,999", 
    median_income==69999 ~ "$60,000 to $69,999", 
    median_income==79999 ~ "$70,000 to $79,999", 
    median_income==89999 ~ "$80,000 to $89,999", 
    median_income==99999 ~ "$90,000 to $99,999",
    median_income==100000 ~ "$100,000 or more",
    median_income==109999 ~ "$100,000 to $109,999", 
    median_income==119999 ~ "$110,000 to $119,999", 
    median_income==129999 ~ "$120,000 to $129,999", 
    median_income==130000 ~ "$130,000 or more"
    ))

median_plot <- ggplot(data = median_pivoted, aes(x = `Financial year`, y = median_income, group = 1)) +
  geom_line() +
  geom_point() +
  labs(title = "Median taxable income group of HELP debtors in Australia from 2009 to 2021 financial year", 
       subtitle = "There has been a positive increase in median taxable income over time", 
       caption = "Data source: Data.gov.au") +
  ylab("Income Group") +
  xlab("Year") +
  theme(panel.grid.major = element_line(color = "grey",
                                        size = 0.5,
                                        linetype = 3),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

median_plot
```

### Chenxi's Part

## Conclusion

## References

## Appendix
